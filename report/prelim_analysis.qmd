---
title: "Preliminary Analysis"
format: html
author: "Vishnu, Mia, and Julia"
editor: visual
---

```{r}
library(tidyverse)
library(gtsummary)
library(ggplot2)
library(psych)
library(cluster)
library(factoextra)
library(dplyr)
library(reticulate)
```

#### Introduction and Data

The data set includes statistics from the 2024 Division 1 and 3 Men’s and Women’s Ultimate Frisbee Championships. The statistics were found on USA Ultimate, the non-profit organization serving as the governing body for ultimate in the United States, and were taken from a data visualization titled “USA Ultimate 2024 Nationals Stats Dashboard”, which was created by Ben Ayres. The data set includes 1665 rows which each correspond to an individual player, and it includes 15 variables which categorize the players by Division, Gender, and Team, and provide game statistics for each player. 

Ultimate frisbee is a sport growing in popularity at the collegiate level and within the Vassar student body as well. However, not much data analysis is available for Ultimate compared to other popular sports. We want to fit a model that would help players analyze their game performance. Therefore, via linear, LASSO, and ridge regression we will fit a prediction model that we train under supervised conditions to be able to predict a player’s plus/minus score (AKA individual impact) based on the variables turns_per_game, ds_per_game, ast_per_game, and pts_per_game. These variables all relate to a player's effectiveness on the field, which is why we will use them to predict pls_mns_per_game. We will also stratify by division and gender, so that we ensure that we have an accurate model for each group. We will have four models in the final product, DI Men, DI Women, DIII Men, and DIII Women.

Since the data was already pretty clean, we did not have to do much data tidying. We just did some string manipulation to extract the school name from the team name, creating a new column called 'school', and had to convert some character variables to factors.

```{r}
ultimate_data <- read_csv("/Users/miazottoli/Desktop/M244-Final-JVM/data/ulti_clean.csv")
```

#### Methodology

#### *Summary Statistics*

```{r}
ultimate_data %>% select(-c(player, team_name)) %>% gtsummary::tbl_summary()
```

```{r}
summary_data <- ultimate_data[, c("pls_mns_per_game", "turns_per_game", "ds_per_game", "ast_per_game", "pts_per_game")]

summary(summary_data)
```

```{r}
describe(summary_data)
```

```{r}
cor(summary_data, use = "complete.obs")
```

```{r}
pairs(summary_data, main = "Pairwise Plots of Ultimate Stats")
```

### *Visualizations*

```{r gender-&-plus-minus}
# Plot player's plus-minus scores and their gender
ggplot(ultimate_data, aes(x = gender, y = plus_minus, fill = gender)) +
  geom_boxplot() +
  labs(
    title = "Gender vs. Player's +/- Score",
    x = "Gender",
    y = "Player's +/- Score"
  ) +
  theme_minimal()

# Filter table to create a new table called d3 that only contains d3 level players
d3 <- ultimate_data[ultimate_data$level == "Division 3",]

# Plot  Division 3 level player's plus-minus scores and their gender
ggplot(d3, aes(x = gender, y = plus_minus, fill = gender)) +
  geom_boxplot() +
  labs(
    title = "Division 3 Gender vs. Player's +/- Score",
    x = "Gender",
    y = "Player's +/- Score"
  ) +
  theme_minimal()

# Filter table to create a new table called d1 that only contains d3 level players
d1 <- ultimate_data[ultimate_data$level == "Division 1",]

# Plot  Division 1 level player's plus-minus scores and their gender
ggplot(d1, aes(x = gender, y = plus_minus, fill = gender)) +
  geom_boxplot() +
  labs(
    title = "Division 1 Gender vs. Player's +/- Score",
    x = "Gender",
    y = "Player's +/- Score"
  ) +
  theme_minimal()
```

```{r division-level-&-plus-minus}
# Plot player's plus-minus score against the divisional level they are playing in
ggplot(ultimate_data, aes(x = level, y = plus_minus, fill = level)) +
  geom_violin(trim = FALSE) +
  labs(
    title = "Player's +/- Score for Division 1 vs Division 3",
    x = "Division",
    y = "Player's +/- Score"
  ) +
  scale_fill_manual(values = c("Division 1" = "blue", "Division 3" = "pink")) + 
  theme_minimal()

# Filter table to create a new table called women_ultimate_data that only contains female players
women_ultimate_data <- ultimate_data %>%
  filter(gender == "Women")

# Plot female player's plus-minus score against the divisional level they are playing in
ggplot(women_ultimate_data, aes(x = level, y = plus_minus, fill = level)) +
  geom_violin(trim = FALSE) +
  labs(
    title = "Player's +/- Score for Division 1 vs Division 3 Women",
    x = "Division",
    y = "Player's +/- Score"
  ) +
  scale_fill_manual(values = c("Division 1" = "blue", "Division 3" = "pink")) + 
  theme_minimal()

# Filter table to create a new table called men_ultimate_data that only contains male players
men_ultimate_data <- ultimate_data %>%
  filter(gender == "Men")

# Plot male player's plus-minus score against the divisional level they are playing in
ggplot(men_ultimate_data, aes(x = level, y = plus_minus, fill = level)) +
  geom_violin(trim = FALSE) +
  labs(
    title = "Player's +/- Score for Division 1 vs Division 3 Men",
    x = "Division",
    y = "Player's +/- Score"
  ) +
  scale_fill_manual(values = c("Division 1" = "blue", "Division 3" = "pink")) + 
  theme_minimal()
```

```{r plus-minus-&-other-variable}

# Plot a player's plus-minus score and their points per game for the different divisions and genders
ultimate_data %>% ggplot(aes(x = pts_per_game, y = plus_minus, color = division)) + 
   geom_point() + geom_smooth(method = 'lm', se = F) + scale_x_log10() +
  labs(x = "Points per game", y = "Plus/Minus", color = "Division") + 
  theme_minimal() +
  scale_color_viridis_d()

# Plot a player's plus-minus score and their D's per game for the different divisions and genders
ultimate_data %>% ggplot(aes(x = ds_per_game, y = plus_minus, color = division)) + 
   geom_point() + geom_smooth(method = 'lm', se = F)+
  theme_minimal() + scale_x_log10() + 
  labs(x = "Ds per game", y = "Plus/Minus", color = "Division") +
  scale_color_viridis_d()

# Plot a player's plus-minus score and their turns per game for the different divisions and genders
ultimate_data %>% ggplot(aes(x = turns_per_game, y = plus_minus, color = division)) + 
   geom_point() + geom_smooth(method = 'lm', se = F) + scale_x_log10() +
  labs(x = "Turns per game", y = "Plus/Minus", color = "Division") + theme_minimal() +
  scale_color_viridis_d()

# Plot a player's plus-minus score and their assists per game for the different divisions and genders
ultimate_data %>% ggplot(aes(x = ast_per_game, y = plus_minus, color = division)) + 
   geom_point() + geom_smooth(method = 'lm', se = F) + scale_x_log10() +
  labs(x = "Assists per game", y = "Plus/Minus", color = "Division") + theme_minimal() +
  scale_color_viridis_d()
```

```{r PCA}

# Create a dataset df1 by selecting the following the columns below
df1 <- ultimate_data %>% select(c(
  turns_per_game, ds_per_game, pts_per_game, pls_mns_per_game, ast_per_game
))

# Perform principle component analysis on df1 
pam_res <- pam(df1[-4], 3)

# Plots the three clusters
fviz_cluster(pam_res, data = df1[-4],
             geom = "point",
             ellipse.type = "convex",
             palette = "jco",
             ggtheme = theme_minimal()) +
  labs(title = "Principal Component Analysis of Ultimate Data")
```

We are fitting all three models that predict continuous variables: linear, LASSO, and ridge regression. Based on the results, we will select the model that is most accurate. Additionally, although the EDA for a player's +/- score seems similar for division and gender, there are slight differences; therefore, we will fit the model for each combination of division and gender.

The methodology section should include visualizations and summary statistics relevant to your research question. You should also justify the choice of method(s) used to answer your research question.

#### Results

Showcase how you arrived at answers to your research question using the techniques we have learned in class (and beyond, if you’re feeling adventurous).

**Provide only the main results from your analysis.** The goal is not to do an exhaustive data analysis (calculate every possible statistic and perform every possible procedure for all variables). Rather, you should demonstrate that you are proficient at asking meaningful questions and answering them using data, that you are skilled in interpreting and presenting results, and that you can accomplish these tasks using R and Python. More is not always better.

#### Discussion

This section is a conclusion and discussion. This will require a summary of what you have learned about your research question along with statistical and methodological arguments supporting your conclusions. You should critique your own methods and provide suggestions for improving your analysis and future work.

You should also discuss issues pertaining to the reliability and validity of your data and the appropriateness of the analyses should also be discussed. You must include at least one paragraph discussing in what ways the training data you used limits any inferential conclusions or predictions for new data you can make.

Finally, discuss whether there may be any ethical concerns with your project. What are the benefits and risks associated with it?

### Formatting

All parts of your project should be professionally formatted. For example, this means labeling plots and figures and turning off code chunks.

**You must comment your code!**

**You must suppress all warnings and messages.**

**You should label your code chunks.**

Style and format does count for this assignment, so please take the time to make sure everything looks good and your data and code are properly formatted.

**For the preliminary analysis, do not suppress code.**

### Grading

Submit your preliminary analysis to Gradescope by **Thursday, April 17, 2025 by 11:59 PM**.

The preliminary analysis will be graded for completion. Each group will be assigned to another group. You will then evaluate each others preliminary analyses and provide feedback. See the next section for more details.

## Peer Review

Critically reviewing others’ work is a crucial part of the data scientific process, and this class is no exception. You will all be given read access to another project repo and have until lab time to provide a detailed critique of the preliminary analysis and data analysis. This review is intended to help you create a high quality final project, as well as give you experience reading and constructively critiquing the work of others.

Groups will be paired by me.

### Before Working on the Review

Before working on the review, carefully read the guidelines for the preliminary analysis/written report.

Think about the below questions as you read over what the other group exchanged with you. You do not have to answer all of these questions and your feedback might depend upon what the other group requests.

### Content

#### Introduction and Data

-   Is the research question and goal of the report clearly stated?
-   Does the introduction provide appropriate background context and motivation for a general reader?
-   Is the source of the data stated with an appropriate citation?
-   Is it clear when and how the data was collected?
-   Is data manipulation described clearly (missing data, creation of new variables, etc)?
-   Are the cases and relevant variables described?

#### Methodology

-   Do the visualizations correspond to the stated research question?
-   Are visualizations effective and do they follow clear visualization principles (including elements like titles, labels, appropriate for the type of data, etc)?
-   Is the choice of method/approach justified?

#### Results

-   Are the chosen techniques for answering the research question appropriate for the research context and type of data?
-   Is the research question answered effectively?

#### Discussion

-   Is the answer to the research question summarized and supported by evidence?
-   Are limitations of the analysis clearly outlined?
-   Do the authors reflect on any implications the nature of the training data has for the generalizability of the findings?
-   Do the authors reflect on the ethicality of their work?

#### Formatting

-   Is their code commented?
-   Are their code chunks labeled?

#### General

-   Is the writing clear (including elements like spelling, grammar, etc)? Are you able to follow what is being done?
-   Is the coding clear? Are you able to follow precisely what is being done?
-   Are you able to reproduce all aspects of the report, including output, visualizations, etc?
-   Is the report well-formatted and readable (including layout but also only reporting relevant output, with no extraneous code, visuals, etc)?
-   Have they appropriate outlined the next steps with gaps clearly defined?
-   Is their repository well-organized or has it been difficult to find certain files?
-   Any suggestions for them moving forward?

#### Final Considerations

-   What is one question you have for the group after reading their analysis?
-   What is one thing the group has done especially well?

You have until **Thursday, April 27, 2025** to provide your comments to the group (with me included) in slack.

### Grading

You will be graded on the effort of your peer review. Your feedback should not be superficial; your goal should be to help your partner group really improve their project. All group members should contribute to the peer review feedback document.

| Total                         | 15 pts  |
|-------------------------------|---------|
| **Breadth of comments**       | 6.5 pts |
| **Depth of comments**         | 6.5 pts |
| **Workflow and Organization** | 2 pts   |
